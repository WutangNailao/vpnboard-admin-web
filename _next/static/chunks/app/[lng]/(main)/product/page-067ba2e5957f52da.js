(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[326],{84233:function(e,n,r){Promise.resolve().then(r.bind(r,25998))},25998:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return _}});var t=r(52948),l=r(30786),s=r(24293),i=r(72216),a=r(44645),c=r(26614),o=r(83336),d=r(92887),u=r(46959),m=r(44517),x=r(78324),h=r(89986),p=r(63854),j=r(19921),f=r(33952),g=r(2720),y=r(44783),v=r(81623),b=r(18849),z=r(52467);let N=u.z.object({name:u.z.string().min(2,{message:"name must be at least 2 characters."}),remarks:u.z.string().optional(),node_groups:u.z.array(u.z.number()).optional(),nodes:u.z.array(u.z.number()).optional()});function C(e){let{onSubmit:n,initialValues:r,loading:c,trigger:d,title:u}=e,[m,x]=(0,l.useState)(!1),C=(0,o.cI)({resolver:(0,i.F)(N),defaultValues:{...r}});async function w(e){await n(e)&&x(!1)}(0,l.useEffect)(()=>{null==C||C.reset(r)},[C,r]);let{data:_}=(0,a.a)({queryKey:["postAdminNodeList","all"],queryFn:async()=>{let{data:e}=await (0,s.HZ)({size:0});return e.data.list}}),{data:k}=(0,a.a)({queryKey:["postAdminNodeGroupList","all"],queryFn:async()=>{let{data:e}=await (0,s.uR)({size:0});return e.data.list}});return(0,t.jsxs)(z.yo,{open:m,onOpenChange:x,children:[(0,t.jsx)(z.aM,{asChild:!0,children:(0,t.jsx)(j.z,{size:"sm",onClick:()=>{C.reset(),x(!0)},children:d})}),(0,t.jsxs)(z.ue,{children:[(0,t.jsx)(z.Tu,{children:(0,t.jsx)(z.bC,{children:u})}),(0,t.jsx)(b.x,{className:"-mx-6 h-[calc(100vh-48px-36px-36px)]",children:(0,t.jsx)(g.l0,{...C,children:(0,t.jsxs)("form",{onSubmit:C.handleSubmit(w),className:"space-y-4 px-6 pt-4",children:[(0,t.jsx)(g.Wi,{control:C.control,name:"name",render:e=>{let{field:n}=e;return(0,t.jsxs)(g.xJ,{children:[(0,t.jsx)(g.lX,{children:"名称"}),(0,t.jsx)(g.NI,{children:(0,t.jsx)(y.I,{...n})}),(0,t.jsx)(g.zG,{})]})}}),(0,t.jsx)(g.Wi,{control:C.control,name:"remarks",render:e=>{let{field:n}=e;return(0,t.jsxs)(g.xJ,{children:[(0,t.jsx)(g.lX,{children:"描述"}),(0,t.jsx)(g.NI,{children:(0,t.jsx)(y.I,{...n})}),(0,t.jsx)(g.zG,{})]})}}),(0,t.jsx)(g.Wi,{control:C.control,name:"node_groups",render:e=>{let{field:n}=e;return(0,t.jsxs)(g.xJ,{children:[(0,t.jsx)(g.lX,{children:"节点组"}),(0,t.jsx)(g.NI,{children:(0,t.jsx)(p.UQ,{type:"single",collapsible:!0,className:"w-full",children:null==k?void 0:k.map(e=>{let r=n.value||[];return(0,t.jsxs)(p.Qd,{value:String(e.id),children:[(0,t.jsx)(p.o4,{children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(f.X,{checked:r.includes(e.id),onCheckedChange:t=>t?n.onChange([...r,e.id]):n.onChange(r.filter(n=>n!==e.id))}),(0,t.jsx)(v.Label,{children:e.name})]})}),(0,t.jsx)(p.vF,{children:(0,t.jsx)("ul",{className:"list-disc [&>li]:mt-2",children:_.filter(n=>n.node_group_id===e.id).map(e=>(0,t.jsxs)("li",{className:"flex items-center justify-between *:flex-1 ",children:[(0,t.jsx)("span",{children:e.name}),(0,t.jsxs)("span",{children:[e.address,":",e.port]}),(0,t.jsx)("span",{className:"text-right",children:e.protocol})]},e.id))})})]},e.id)})})}),(0,t.jsx)(g.zG,{})]})}}),(0,t.jsx)(g.Wi,{control:C.control,name:"nodes",render:e=>{var n;let{field:r}=e;return(0,t.jsxs)(g.xJ,{children:[(0,t.jsx)(g.lX,{children:"节点"}),(0,t.jsx)(g.NI,{children:(0,t.jsx)("div",{className:"flex flex-col gap-2",children:null==_?void 0:null===(n=_.filter(e=>!e.node_group_id))||void 0===n?void 0:n.map(e=>{let n=r.value||[];return(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(f.X,{checked:n.includes(e.id),onCheckedChange:t=>t?r.onChange([...n,e.id]):r.onChange(n.filter(n=>n!==e.id))}),(0,t.jsxs)(v.Label,{className:"flex w-full items-center justify-between *:flex-1",children:[(0,t.jsx)("span",{children:e.name}),(0,t.jsxs)("span",{children:[e.address,":",e.port]}),(0,t.jsx)("span",{className:"text-right",children:e.protocol})]})]},e.id)})})}),(0,t.jsx)(g.zG,{})]})}})]})})}),(0,t.jsxs)(z.FF,{className:"flex-row justify-end gap-2 pt-3",children:[(0,t.jsx)(j.z,{variant:"outline",disabled:c,onClick:()=>{x(!1)},children:"取消"}),(0,t.jsxs)(j.z,{disabled:c,onClick:C.handleSubmit(w),children:[c&&(0,t.jsx)(h.Icon,{icon:"mdi:loading",className:"mr-2 animate-spin"})," 确定"]})]})]})]})}let w=u.z.object({name:u.z.string().min(2,{message:"name must be at least 2 characters."}),remarks:u.z.string().optional(),node_groups:u.z.array(u.z.number()).optional(),nodes:u.z.array(u.z.number()).optional()});function _(){var e,n;let{data:r,refetch:u}=(0,a.a)({queryKey:["postAdminProductList"],queryFn:async()=>{let{data:e}=await (0,s._n)();return e.data}}),{data:h}=(0,a.a)({queryKey:["postAdminNodeList","all"],queryFn:async()=>{let{data:e}=await (0,s.HZ)({size:0});return e.data.list}}),{data:p}=(0,a.a)({queryKey:["postAdminNodeGroupList","all"],queryFn:async()=>{let{data:e}=await (0,s.uR)({size:0});return e.data.list}}),[j,f]=(0,l.useState)(!1),[g,y]=(0,l.useState)(!1),[v,b]=(0,l.useState)();(0,o.cI)({resolver:(0,i.F)(w)});let z=[{accessorKey:"name",header:"名称"},{accessorKey:"remarks",header:"描述"},{accessorKey:"updated_at",header:"更新时间",cell:e=>{let{row:n}=e;return(0,c.p6)(n.getValue("updated_at"),"yyyy-MM-dd HH:mm:ss")}},{id:"actions",accessorKey:"id",header:()=>(0,t.jsx)("div",{className:"text-right",children:"操作"}),cell:e=>{var n,r;let{row:l}=e;return(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsx)(C,{trigger:"编辑",title:"编辑商品",loading:j,initialValues:{...l.original,id:l.original.id,node_groups:null===(n=l.original.node_groups)||void 0===n?void 0:n.map(e=>e.id),nodes:null===(r=l.original.nodes)||void 0===r?void 0:r.map(e=>e.id)},onSubmit:async e=>{f(!0);try{return await (0,s.th)({...e,id:l.original.id}),d.A.success("更新成功"),u(),f(!1),!0}catch(e){return f(!1),!1}}}),(0,t.jsx)(x.Z,{trigger:"删除",title:"你确定要删除吗?",description:"删除后数据将无法恢复，请谨慎操作",onConfirm:async()=>{await (0,s.W4)({id:l.original.id}),d.A.success("删除成功"),u()},onCancelText:"取消",onConfirmText:"确认"})]})}}];return(0,t.jsx)(m.w,{header:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h1",{children:"商品列表"}),(0,t.jsx)(C,{trigger:"新建",title:"新建商品",loading:j,onSubmit:async e=>{f(!0);try{return await (0,s.Tb)(e),d.A.success("创建成功"),u(),f(!1),!0}catch(e){return f(!1),!1}}})]}),columns:z,data:(null==r?void 0:r.list)||[],pagination:{page:1,size:null==r?void 0:null===(e=r.list)||void 0===e?void 0:e.length,total:null==r?void 0:null===(n=r.list)||void 0===n?void 0:n.length},operations:{remove:async e=>{e.forEach(async e=>{await (0,s.W4)({id:e.id})}),d.A.success("删除成功"),u()}}})}},91667:function(e,n,r){"use strict";r.d(n,{B:function(){return a}});var t=r(30786),l=r(69726),s=r(45477),i=r(63911);function a(e){let n=e+"CollectionProvider",[r,a]=(0,l.b)(n),[c,o]=r(n,{collectionRef:{current:null},itemMap:new Map}),d=e+"CollectionSlot",u=t.forwardRef((e,n)=>{let{scope:r,children:l}=e,a=o(d,r),c=(0,s.e)(n,a.collectionRef);return t.createElement(i.g7,{ref:c},l)}),m=e+"CollectionItemSlot",x="data-radix-collection-item";return[{Provider:e=>{let{scope:n,children:r}=e,l=t.useRef(null),s=t.useRef(new Map).current;return t.createElement(c,{scope:n,itemMap:s,collectionRef:l},r)},Slot:u,ItemSlot:t.forwardRef((e,n)=>{let{scope:r,children:l,...a}=e,c=t.useRef(null),d=(0,s.e)(n,c),u=o(m,r);return t.useEffect(()=>(u.itemMap.set(c,{ref:c,...a}),()=>void u.itemMap.delete(c))),t.createElement(i.g7,{[x]:"",ref:d},l)})},function(n){let r=o(e+"CollectionConsumer",n);return t.useCallback(()=>{let e=r.collectionRef.current;if(!e)return[];let n=Array.from(e.querySelectorAll(`[${x}]`));return Array.from(r.itemMap.values()).sort((e,r)=>n.indexOf(e.ref.current)-n.indexOf(r.ref.current))},[r.collectionRef,r.itemMap])},a]}}},function(e){e.O(0,[792,1896,736,9986,4699,1960,6035,2494,7647,5362,6856,4645,1826,839,7625,2100,1162,1744],function(){return e(e.s=84233)}),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[326],{84233:function(e,t,r){Promise.resolve().then(r.bind(r,25998))},25998:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return R}});var n=r(52948),a=r(30786),s=r(24293),i=r(72216),l=r(44645),o=r(26614),d=r(83336),c=r(92887),u=r(46959),m=r(44517),f=r(78324),x=r(89986),p=r(63854),h=r(19921),j=r(33952),y=r(2720),g=r(44783),N=r(81623),v=r(18849),b=r(52467);let w=u.z.object({name:u.z.string().min(2,{message:"name must be at least 2 characters."}),remarks:u.z.string().optional(),node_groups:u.z.array(u.z.number()).optional(),nodes:u.z.array(u.z.number()).optional()});function z(e){let{onSubmit:t,initialValues:r,loading:o,trigger:c,title:u}=e,[m,f]=(0,a.useState)(!1),z=(0,d.cI)({resolver:(0,i.F)(w),defaultValues:{...r}});async function C(e){await t(e)&&f(!1)}(0,a.useEffect)(()=>{null==z||z.reset(r)},[z,r]);let{data:R}=(0,l.a)({queryKey:["postAdminNodeList","all"],queryFn:async()=>{let{data:e}=await (0,s.HZ)({size:0});return e.data.list}}),{data:F}=(0,l.a)({queryKey:["postAdminNodeGroupList","all"],queryFn:async()=>{let{data:e}=await (0,s.uR)({size:0});return e.data.list}});return(0,n.jsxs)(b.yo,{open:m,onOpenChange:f,children:[(0,n.jsx)(b.aM,{asChild:!0,children:(0,n.jsx)(h.z,{size:"sm",onClick:()=>{z.reset(),f(!0)},children:c})}),(0,n.jsxs)(b.ue,{children:[(0,n.jsx)(b.Tu,{children:(0,n.jsx)(b.bC,{children:u})}),(0,n.jsx)(v.x,{className:"-mx-6 h-[calc(100vh-48px-36px-36px)]",children:(0,n.jsx)(y.l0,{...z,children:(0,n.jsxs)("form",{onSubmit:z.handleSubmit(C),className:"space-y-4 px-6 pt-4",children:[(0,n.jsx)(y.Wi,{control:z.control,name:"name",render:e=>{let{field:t}=e;return(0,n.jsxs)(y.xJ,{children:[(0,n.jsx)(y.lX,{children:"名称"}),(0,n.jsx)(y.NI,{children:(0,n.jsx)(g.I,{...t})}),(0,n.jsx)(y.zG,{})]})}}),(0,n.jsx)(y.Wi,{control:z.control,name:"remarks",render:e=>{let{field:t}=e;return(0,n.jsxs)(y.xJ,{children:[(0,n.jsx)(y.lX,{children:"描述"}),(0,n.jsx)(y.NI,{children:(0,n.jsx)(g.I,{...t})}),(0,n.jsx)(y.zG,{})]})}}),(0,n.jsx)(y.Wi,{control:z.control,name:"node_groups",render:e=>{let{field:t}=e;return(0,n.jsxs)(y.xJ,{children:[(0,n.jsx)(y.lX,{children:"节点组"}),(0,n.jsx)(y.NI,{children:(0,n.jsx)(p.UQ,{type:"single",collapsible:!0,className:"w-full",children:null==F?void 0:F.map(e=>{let r=t.value||[];return(0,n.jsxs)(p.Qd,{value:String(e.id),children:[(0,n.jsx)(p.o4,{children:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(j.X,{checked:r.includes(e.id),onCheckedChange:n=>n?t.onChange([...r,e.id]):t.onChange(r.filter(t=>t!==e.id))}),(0,n.jsx)(N.Label,{children:e.name})]})}),(0,n.jsx)(p.vF,{children:(0,n.jsx)("ul",{className:"list-disc [&>li]:mt-2",children:R.filter(t=>t.node_group_id===e.id).map(e=>(0,n.jsxs)("li",{className:"flex items-center justify-between *:flex-1 ",children:[(0,n.jsx)("span",{children:e.name}),(0,n.jsxs)("span",{children:[e.address,":",e.port]}),(0,n.jsx)("span",{className:"text-right",children:e.protocol})]},e.id))})})]},e.id)})})}),(0,n.jsx)(y.zG,{})]})}}),(0,n.jsx)(y.Wi,{control:z.control,name:"nodes",render:e=>{var t;let{field:r}=e;return(0,n.jsxs)(y.xJ,{children:[(0,n.jsx)(y.lX,{children:"节点"}),(0,n.jsx)(y.NI,{children:(0,n.jsx)("div",{className:"flex flex-col gap-2",children:null==R?void 0:null===(t=R.filter(e=>!e.node_group_id))||void 0===t?void 0:t.map(e=>{let t=r.value||[];return(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(j.X,{checked:t.includes(e.id),onCheckedChange:n=>n?r.onChange([...t,e.id]):r.onChange(t.filter(t=>t!==e.id))}),(0,n.jsxs)(N.Label,{className:"flex w-full items-center justify-between *:flex-1",children:[(0,n.jsx)("span",{children:e.name}),(0,n.jsxs)("span",{children:[e.address,":",e.port]}),(0,n.jsx)("span",{className:"text-right",children:e.protocol})]})]},e.id)})})}),(0,n.jsx)(y.zG,{})]})}})]})})}),(0,n.jsxs)(b.FF,{className:"flex-row justify-end gap-2 pt-3",children:[(0,n.jsx)(h.z,{variant:"outline",disabled:o,onClick:()=>{f(!1)},children:"取消"}),(0,n.jsxs)(h.z,{disabled:o,onClick:z.handleSubmit(C),children:[o&&(0,n.jsx)(x.Icon,{icon:"mdi:loading",className:"mr-2 animate-spin"})," 确定"]})]})]})]})}let C=u.z.object({name:u.z.string().min(2,{message:"name must be at least 2 characters."}),remarks:u.z.string().optional(),node_groups:u.z.array(u.z.number()).optional(),nodes:u.z.array(u.z.number()).optional()});function R(){var e,t;let{data:r,refetch:u}=(0,l.a)({queryKey:["postAdminProductList"],queryFn:async()=>{let{data:e}=await (0,s._n)();return e.data}}),{data:x}=(0,l.a)({queryKey:["postAdminNodeList","all"],queryFn:async()=>{let{data:e}=await (0,s.HZ)({size:0});return e.data.list}}),{data:p}=(0,l.a)({queryKey:["postAdminNodeGroupList","all"],queryFn:async()=>{let{data:e}=await (0,s.uR)({size:0});return e.data.list}}),[h,j]=(0,a.useState)(!1),[y,g]=(0,a.useState)(!1),[N,v]=(0,a.useState)();(0,d.cI)({resolver:(0,i.F)(C)});let b=[{accessorKey:"name",header:"名称"},{accessorKey:"remarks",header:"描述"},{accessorKey:"updated_at",header:"更新时间",cell:e=>{let{row:t}=e;return(0,o.p6)(t.getValue("updated_at"),"yyyy-MM-dd HH:mm:ss")}},{id:"actions",accessorKey:"id",header:()=>(0,n.jsx)("div",{className:"text-right",children:"操作"}),cell:e=>{var t,r;let{row:a}=e;return(0,n.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,n.jsx)(z,{trigger:"编辑",title:"编辑商品",loading:h,initialValues:{...a.original,id:a.original.id,node_groups:null===(t=a.original.node_groups)||void 0===t?void 0:t.map(e=>e.id),nodes:null===(r=a.original.nodes)||void 0===r?void 0:r.map(e=>e.id)},onSubmit:async e=>{j(!0);try{return await (0,s.th)({...e,id:a.original.id}),c.A.success("更新成功"),u(),j(!1),!0}catch(e){return j(!1),!1}}}),(0,n.jsx)(f.Z,{trigger:"删除",title:"你确定要删除吗?",description:"删除后数据将无法恢复，请谨慎操作",onConfirm:async()=>{await (0,s.W4)({id:a.original.id}),c.A.success("删除成功"),u()},onCancelText:"取消",onConfirmText:"确认"})]})}}];return(0,n.jsx)(m.w,{header:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("h1",{children:"商品列表"}),(0,n.jsx)(z,{trigger:"新建",title:"新建商品",loading:h,onSubmit:async e=>{j(!0);try{return await (0,s.Tb)(e),c.A.success("创建成功"),u(),j(!1),!0}catch(e){return j(!1),!1}}})]}),columns:b,data:(null==r?void 0:r.list)||[],pagination:{page:1,size:null==r?void 0:null===(e=r.list)||void 0===e?void 0:e.length,total:null==r?void 0:null===(t=r.list)||void 0===t?void 0:t.length},operations:{remove:async e=>{e.forEach(async e=>{await (0,s.W4)({id:e.id})}),c.A.success("删除成功"),u()}}})}},63854:function(e,t,r){"use strict";r.d(t,{Qd:function(){return d},UQ:function(){return o},o4:function(){return c},vF:function(){return u}});var n=r(52948),a=r(30786),s=r(11826),i=r(28523),l=r(33412);let o=s.fC,d=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)(s.ck,{ref:t,className:(0,l.cn)("border-b",r),...a})});d.displayName="AccordionItem";let c=a.forwardRef((e,t)=>{let{className:r,children:a,...o}=e;return(0,n.jsx)(s.h4,{className:"flex",children:(0,n.jsxs)(s.xz,{ref:t,className:(0,l.cn)("flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",r),...o,children:[a,(0,n.jsx)(i.v4q,{className:"size-4 shrink-0 text-muted-foreground transition-transform duration-200"})]})})});c.displayName=s.xz.displayName;let u=a.forwardRef((e,t)=>{let{className:r,children:a,...i}=e;return(0,n.jsx)(s.VY,{ref:t,className:"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...i,children:(0,n.jsx)("div",{className:(0,l.cn)("pb-4 pt-0",r),children:a})})});u.displayName=s.VY.displayName},2720:function(e,t,r){"use strict";r.d(t,{NI:function(){return h},Wi:function(){return u},l0:function(){return d},lX:function(){return p},xJ:function(){return x},zG:function(){return j}});var n=r(52948),a=r(30786),s=r(63911),i=r(83336),l=r(33412),o=r(81623);let d=i.RV,c=a.createContext({}),u=e=>{let{...t}=e;return(0,n.jsx)(c.Provider,{value:{name:t.name},children:(0,n.jsx)(i.Qr,{...t})})},m=()=>{let e=a.useContext(c),t=a.useContext(f),{getFieldState:r,formState:n}=(0,i.Gc)(),s=r(e.name,n);if(!e)throw Error("useFormField should be used within <FormField>");let{id:l}=t;return{id:l,name:e.name,formItemId:"".concat(l,"-form-item"),formDescriptionId:"".concat(l,"-form-item-description"),formMessageId:"".concat(l,"-form-item-message"),...s}},f=a.createContext({}),x=a.forwardRef((e,t)=>{let{className:r,...s}=e,i=a.useId();return(0,n.jsx)(f.Provider,{value:{id:i},children:(0,n.jsx)("div",{ref:t,className:(0,l.cn)("space-y-2",r),...s})})});x.displayName="FormItem";let p=a.forwardRef((e,t)=>{let{className:r,...a}=e,{error:s,formItemId:i}=m();return(0,n.jsx)(o.Label,{ref:t,className:(0,l.cn)(s&&"text-destructive",r),htmlFor:i,...a})});p.displayName="FormLabel";let h=a.forwardRef((e,t)=>{let{...r}=e,{error:a,formItemId:i,formDescriptionId:l,formMessageId:o}=m();return(0,n.jsx)(s.g7,{ref:t,id:i,"aria-describedby":a?"".concat(l," ").concat(o):"".concat(l),"aria-invalid":!!a,...r})});h.displayName="FormControl",a.forwardRef((e,t)=>{let{className:r,...a}=e,{formDescriptionId:s}=m();return(0,n.jsx)("p",{ref:t,id:s,className:(0,l.cn)("text-[0.8rem] text-muted-foreground",r),...a})}).displayName="FormDescription";let j=a.forwardRef((e,t)=>{let{className:r,children:a,...s}=e,{error:i,formMessageId:o}=m(),d=i?String(null==i?void 0:i.message):a;return d?(0,n.jsx)("p",{ref:t,id:o,className:(0,l.cn)("text-[0.8rem] font-medium text-destructive",r),...s,children:d}):null});j.displayName="FormMessage"},52467:function(e,t,r){"use strict";r.d(t,{FF:function(){return h},Tu:function(){return p},aM:function(){return c},bC:function(){return j},ue:function(){return x},yo:function(){return d}});var n=r(52948),a=r(30786),s=r(97647),i=r(28523),l=r(14709),o=r(33412);let d=s.fC,c=s.xz;s.x8;let u=s.h_,m=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)(s.aV,{className:(0,o.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...a,ref:t})});m.displayName=s.aV.displayName;let f=(0,l.j)("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),x=a.forwardRef((e,t)=>{let{side:r="right",className:a,children:l,...d}=e;return(0,n.jsxs)(u,{children:[(0,n.jsx)(m,{}),(0,n.jsxs)(s.VY,{ref:t,className:(0,o.cn)(f({side:r}),a),...d,children:[l,(0,n.jsxs)(s.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,n.jsx)(i.Pxu,{className:"size-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});x.displayName=s.VY.displayName;let p=e=>{let{className:t,...r}=e;return(0,n.jsx)("div",{className:(0,o.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...r})};p.displayName="SheetHeader";let h=e=>{let{className:t,...r}=e;return(0,n.jsx)("div",{className:(0,o.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...r})};h.displayName="SheetFooter";let j=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)(s.Dx,{ref:t,className:(0,o.cn)("text-lg font-semibold text-foreground",r),...a})});j.displayName=s.Dx.displayName,a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)(s.dk,{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",r),...a})}).displayName=s.dk.displayName},91667:function(e,t,r){"use strict";r.d(t,{B:function(){return l}});var n=r(30786),a=r(69726),s=r(45477),i=r(63911);function l(e){let t=e+"CollectionProvider",[r,l]=(0,a.b)(t),[o,d]=r(t,{collectionRef:{current:null},itemMap:new Map}),c=e+"CollectionSlot",u=n.forwardRef((e,t)=>{let{scope:r,children:a}=e,l=d(c,r),o=(0,s.e)(t,l.collectionRef);return n.createElement(i.g7,{ref:o},a)}),m=e+"CollectionItemSlot",f="data-radix-collection-item";return[{Provider:e=>{let{scope:t,children:r}=e,a=n.useRef(null),s=n.useRef(new Map).current;return n.createElement(o,{scope:t,itemMap:s,collectionRef:a},r)},Slot:u,ItemSlot:n.forwardRef((e,t)=>{let{scope:r,children:a,...l}=e,o=n.useRef(null),c=(0,s.e)(t,o),u=d(m,r);return n.useEffect(()=>(u.itemMap.set(o,{ref:o,...l}),()=>void u.itemMap.delete(o))),n.createElement(i.g7,{[f]:"",ref:c},a)})},function(t){let r=d(e+"CollectionConsumer",t);return n.useCallback(()=>{let e=r.collectionRef.current;if(!e)return[];let t=Array.from(e.querySelectorAll(`[${f}]`));return Array.from(r.itemMap.values()).sort((e,r)=>t.indexOf(e.ref.current)-t.indexOf(r.ref.current))},[r.collectionRef,r.itemMap])},l]}}},function(e){e.O(0,[792,1896,736,9986,4699,1960,6035,2494,7647,5362,6856,4645,1826,786,4517,2100,1162,1744],function(){return e(e.s=84233)}),_N_E=e.O()}]);
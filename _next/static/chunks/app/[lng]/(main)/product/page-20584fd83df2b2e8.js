(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[326],{4233:function(e,s,n){Promise.resolve().then(n.bind(n,91))},91:function(e,s,n){"use strict";n.r(s),n.d(s,{default:function(){return C}});var i=n(2948),l=n(786),r=n(4293),a=n(2216),d=n(9986),t=n(4645),c=n(2098),o=n(3124),u=n(2887),x=n(3989),h=n(3854),j=n(9921),m=n(3952),p=n(2720),f=n(4783),g=n(1623),y=n(8849),v=n(2467),N=n(3328),z=n(8324);let b=x.z.object({name:x.z.string().min(2,{message:"name must be at least 2 characters."}),remarks:x.z.string().optional(),node_groups:x.z.array(x.z.number()).optional(),nodes:x.z.array(x.z.number()).optional()});function C(){var e,s;let{data:n,refetch:x}=(0,t.a)({queryKey:["postAdminProductList"],queryFn:async()=>{let{data:e}=await (0,r._n)();return e.data}}),{data:C}=(0,t.a)({queryKey:["postAdminNodeList","all"],queryFn:async()=>{let{data:e}=await (0,r.HZ)({size:0});return e.data.list}}),{data:_}=(0,t.a)({queryKey:["postAdminNodeGroupList","all"],queryFn:async()=>{let{data:e}=await (0,r.uR)({size:0});return e.data.list}}),[k,w]=(0,l.useState)(!1),[I,K]=(0,l.useState)(!1),[q,A]=(0,l.useState)(),S=(0,o.cI)({resolver:(0,a.F)(b)});async function W(e){w(!0);let s=(null==q?void 0:q.id)?r.th:r.Tb,n=(null==q?void 0:q.id)?{...q,id:q.id,...e}:e,{data:i}=await s(n);0===i.code&&(x(),u.A.success((null==q?void 0:q.id)?"更新成功":"创建成功"),K(!1),A(void 0),S.reset()),w(!1)}return(0,i.jsx)(N.w,{header:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)("h1",{children:"商品列表"}),(0,i.jsxs)(v.yo,{open:I,onOpenChange:K,children:[(0,i.jsx)(v.aM,{asChild:!0,children:(0,i.jsx)(j.z,{size:"sm",onClick:()=>{A(void 0),S.reset()},children:"新建"})}),(0,i.jsxs)(v.ue,{children:[(0,i.jsx)(v.Tu,{children:(0,i.jsxs)(v.bC,{children:[(null==q?void 0:q.id)?"编辑":"创建","商品"]})}),(0,i.jsx)(y.x,{className:"h-[calc(100vh-48px-28px)]",children:(0,i.jsx)(p.l0,{...S,children:(0,i.jsxs)("form",{onSubmit:S.handleSubmit(W),className:"space-y-6",children:[(0,i.jsx)(p.Wi,{control:S.control,name:"name",render:e=>{let{field:s}=e;return(0,i.jsxs)(p.xJ,{children:[(0,i.jsx)(p.lX,{children:"名称"}),(0,i.jsx)(p.NI,{children:(0,i.jsx)(f.I,{...s})}),(0,i.jsx)(p.zG,{})]})}}),(0,i.jsx)(p.Wi,{control:S.control,name:"remarks",render:e=>{let{field:s}=e;return(0,i.jsxs)(p.xJ,{children:[(0,i.jsx)(p.lX,{children:"描述"}),(0,i.jsx)(p.NI,{children:(0,i.jsx)(f.I,{...s})}),(0,i.jsx)(p.zG,{})]})}}),(0,i.jsx)(p.Wi,{control:S.control,name:"node_groups",render:e=>{let{field:s}=e;return(0,i.jsxs)(p.xJ,{children:[(0,i.jsx)(p.lX,{children:"节点组"}),(0,i.jsx)(p.NI,{children:(0,i.jsx)(h.UQ,{type:"single",collapsible:!0,className:"w-full",children:null==_?void 0:_.map(e=>{let n=s.value||[];return(0,i.jsxs)(h.Qd,{value:String(e.id),children:[(0,i.jsx)(h.o4,{children:(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(m.X,{checked:n.includes(e.id),onCheckedChange:i=>i?s.onChange([...n,e.id]):s.onChange(n.filter(s=>s!==e.id))}),(0,i.jsx)(g._,{children:e.name})]})}),(0,i.jsx)(h.vF,{children:(0,i.jsx)("ul",{className:"list-disc [&>li]:mt-2",children:C.filter(s=>s.node_group_id===e.id).map(e=>(0,i.jsxs)("li",{className:"flex items-center justify-between *:flex-1 ",children:[(0,i.jsx)("span",{children:e.name}),(0,i.jsxs)("span",{children:[e.address,":",e.port]}),(0,i.jsx)("span",{className:"text-right",children:e.protocol})]},e.id))})})]},e.id)})})}),(0,i.jsx)(p.zG,{})]})}}),(0,i.jsx)(p.Wi,{control:S.control,name:"nodes",render:e=>{var s;let{field:n}=e;return(0,i.jsxs)(p.xJ,{children:[(0,i.jsx)(p.lX,{children:"节点"}),(0,i.jsx)(p.NI,{children:(0,i.jsx)("div",{className:"flex flex-col gap-2",children:null==C?void 0:null===(s=C.filter(e=>!e.node_group_id))||void 0===s?void 0:s.map(e=>{let s=n.value||[];return(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(m.X,{checked:s.includes(e.id),onCheckedChange:i=>i?n.onChange([...s,e.id]):n.onChange(s.filter(s=>s!==e.id))}),(0,i.jsxs)(g._,{className:"flex w-full items-center justify-between *:flex-1",children:[(0,i.jsx)("span",{children:e.name}),(0,i.jsxs)("span",{children:[e.address,":",e.port]}),(0,i.jsx)("span",{className:"text-right",children:e.protocol})]})]},e.id)})})}),(0,i.jsx)(p.zG,{})]})}}),(0,i.jsx)("div",{className:"flex justify-end",children:(0,i.jsxs)(j.z,{type:"submit",disabled:k,children:[k&&(0,i.jsx)(d.JO,{icon:"mdi:loading",className:"animate-spi mr-2"})," 确定"]})})]})})})]})]})]}),columns:[{accessorKey:"name",header:"名称"},{accessorKey:"remarks",header:"描述"},{accessorKey:"updated_at",header:"更新时间",cell:e=>{let{row:s}=e;return(0,c.p6)(s.getValue("updated_at"),"yyyy-MM-dd HH:mm:ss")}},{id:"actions",accessorKey:"id",header:()=>(0,i.jsx)("div",{className:"text-right",children:"操作"}),cell:e=>{let{row:s}=e;return(0,i.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,i.jsx)(j.z,{size:"sm",onClick:()=>{A(s.original),Object.keys(s.original).forEach(e=>{["nodes","node_groups"].includes(e)?S.setValue(e,s.original[e].map(e=>e.id)):S.setValue(e,s.original[e])}),K(!0)},children:"编辑"}),(0,i.jsx)(z.Z,{trigger:"删除",title:"你确定要删除吗?",description:"删除后数据将无法恢复，请谨慎操作",onConfirm:async()=>{await (0,r.W4)({id:s.original.id}),u.A.success("删除成功"),x()},onCancelText:"取消",onConfirmText:"确认"})]})}}],data:(null==n?void 0:n.list)||[],pagination:{page:1,size:null==n?void 0:null===(e=n.list)||void 0===e?void 0:e.length,total:null==n?void 0:null===(s=n.list)||void 0===s?void 0:s.length},operations:{remove:async e=>{e.forEach(async e=>{await (0,r.W4)({id:e.id})}),u.A.success("删除成功"),x()}}})}}},function(e){e.O(0,[792,1896,9185,2887,778,3624,8450,4075,2494,8422,1326,6661,2100,1162,1744],function(){return e(e.s=4233)}),_N_E=e.O()}]);